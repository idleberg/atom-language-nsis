"use strict";var e,i=require("./main-25d89b16.js"),t=require("fs"),n=require("path");function r(r){return i.__awaiter(this,void 0,void 0,(function(){var s,a,o,u,c,l,d,f,m,g,h,b,p,v;return i.__generator(this,(function(w){switch(w.label){case 0:return[4,Promise.resolve().then((function(){return require("./main-25d89b16.js")})).then((function(e){return e.util}))];case 1:return s=w.sent(),a=s.findPackagePath,o=s.getMakensisPath,u=s.isLoadedAndActive,c=i.Config.get("useWineToRun"),l=u("build-makensis-wine"),[4,a("build-makensis-wine")];case 2:return d=w.sent()[0],f=[],(m=parseInt(String(i.Config.get("compilerOptions.verbosity"))))&&f.push("-V"+m),i.Config.get("compilerOptions.strictMode")&&f.push("-WX"),v={name:r.scriptFile},c&&l?(h=n.resolve(d,"lib","makensis-wine.sh"),[3,5]):[3,3];case 3:return[4,o()];case 4:h=w.sent(),w.label=5;case 5:return v.cmd=h,v.sh=c&&l,v.args=i.__spreadArray(i.__spreadArray([],f,!0),["{FILE_ACTIVE}"],!1),v.cwd="{FILE_ACTIVE_PATH}",v.errorMatch='(\\r?\\n)(?<message>.+)(\\r?\\n)Error in script "(?<file>[^"]+)" on line (?<line>\\d+) -- aborting creation process',v.warningMatch="[^!]warning: (?<message>.*) \\((?<file>(\\w{1}:)?[^:]+):(?<line>\\d+)\\)",g=v,"yaml"!==r.syntax?[3,7]:[4,Promise.resolve().then((function(){return require("./index-8280b4ad.js")})).then((function(e){return e.index}))];case 6:e=w.sent(),w.label=7;case 7:b="yaml"===r.syntax?e.stringify(g):JSON.stringify(g,null,2),w.label=8;case 8:return w.trys.push([8,10,,11]),[4,t.promises.writeFile(r.filePath,b,"utf-8")];case 9:return w.sent(),[3,11];case 10:return p=w.sent(),console.log(p),atom.notifications.addError("Failed to write "+r.fileName,{detail:p,dismissable:!1}),[2];case 11:return[4,atom.workspace.open(r.filePath)];case 12:return w.sent(),[2]}}))}))}require("child_process"),require("os"),require("atom"),exports.createBuildFile=function(){var e,t;return i.__awaiter(this,void 0,void 0,(function(){var s,a,o,u,c,l,d,f,m,g,h,b;return i.__generator(this,(function(p){switch(p.label){case 0:return(s=atom.workspace.getActiveTextEditor())?"source.nsis"!==s.getGrammar().scopeName?(atom.notifications.addWarning("Unsupported document type",{dismissable:!1}),[2]):(a=s.getPath(),[4,Promise.resolve().then((function(){return require("./main-25d89b16.js")})).then((function(e){return e.util}))]):(atom.notifications.addWarning("No active editor",{dismissable:!1}),[2]);case 1:return o=p.sent().isHeaderFile,i.Config.get("processHeaders")&&o(a)?(u=atom.notifications.addWarning("Creating build-files for headers is blocked by default. You can allow this in the package settings.",{dismissable:!0,buttons:[{text:"Open Settings",className:"icon icon-gear",onDidClick:function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return u.dismiss(),[4,atom.workspace.open("atom://config/packages/language-nsis",{pending:!0,searchAllPanes:!0})];case 1:return e.sent(),[2]}}))}))}},{text:"Cancel",onDidClick:function(){u.dismiss()}}]}),atom.beep(),[2]):(c=(null===(t=null===(e=atom.workspace)||void 0===e?void 0:e.getActiveTextEditor())||void 0===t?void 0:t.getPath())||null)?(d=n.basename(c),f=n.dirname(c),m=String(i.Config.get("buildFileSyntax")),g=".atom-build."+m.toLowerCase(),h=n.join(f,g),[4,Promise.resolve().then((function(){return require("./main-25d89b16.js")})).then((function(e){return e.util}))]):(l=atom.notifications.addWarning("File not saved",{dismissable:!0,detail:"You need to save this file manually before you can create a build-file",buttons:[{text:"OK",onDidClick:function(){l.dismiss()}}]}),[2]);case 2:return[4,(0,p.sent().fileExists)(h)];case 3:return p.sent()?b=atom.notifications.addWarning("File exists",{dismissable:!0,detail:"Do you really want to overwrite your existing build file?",buttons:[{text:"Overwrite",onDidClick:function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return b.dismiss(),r({script:d,syntax:m,fileName:g,filePath:h}),[2]}))}))}},{text:"Abort",onDidClick:function(){b.dismiss()}}]}):r({script:d,syntax:m,fileName:g,filePath:h}),[2]}}))}))};
//# sourceMappingURL=build-3e8a9e5b.js.map
