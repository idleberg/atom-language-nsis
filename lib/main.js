module.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){var i,o,s;({readManifestSync:s}=n(2)),o=s(),e.exports=i={clearConsole:function(e){try{return e.clear()}catch(e){if(i.getConfig("clearConsole"))return console.clear()}},detectOutfile:function(e){return-1!==e.indexOf('Output: "')?/Output: \"(.*\.exe)\"\r?\n/g.exec(e.toString())[1]:""},getConfig:function(e=""){return null!=e?atom.config.get(`${o.name}.${e}`):atom.config.get(`${o.name}`)},getMakensisPath:function(e){var t,s,a;return({spawn:s}=n(1)),(t=i.getConfig("pathToMakensis")).length>0&&"makensis"!==t?e(t):((a=s(i.which(),["makensis"])).stdout.on("data",function(t){var n;return n=t.toString().trim(),atom.config.set(`${o.name}.pathToMakensis`,n),e(n)}),a.on("close",function(e){if(e>0)return atom.notifications.addError(`**${o.name}**: makensis is not in your \`PATH\` [environmental variable](http://superuser.com/a/284351/195953)`,{dismissable:!0})}))},getPrefix:function(){var e;return({platform:e}=n(3)),"win32"===e()?"/":"-"},isWindowsCompatible:function(){var e;return({platform:e}=n(3)),"win32"===e()||!0===i.getConfig("useWineToRun")},logCompilerFlags:function(e,t,n){var s;if(s=!0===t?JSON.stringify(e.stdout,null,2):e.stdout,"console"!==i.getConfig("compilerOutput").toLowerCase())return atom.notifications.addInfo(`**${o.name}**`,{detail:s,dismissable:!0});try{return n.raw(s)}catch(e){return console.info(s),atom.getCurrentWindow().openDevTools()}},notifyOnCompletion:function(e,t,n){var o,s,a,r,c;return o=[],a=!1,n&&("Run"===t&&(a=!0,t={text:t,className:"icon icon-playback-play",onDidClick:function(){return r.dismiss(),i.runInstaller(n)}},o.push(t)),c={text:"Reveal",className:"icon icon-location",onDidClick:function(){return r.dismiss(),i.revealInstaller(n)}},s={text:"Cancel",onDidClick:function(){return r.dismiss()}},o.push(c),o.push(s)),r="warning"===e?atom.notifications.addWarning("Compiled with warnings",{dismissable:a,buttons:o}):atom.notifications.addSuccess("Compiled successfully",{dismissable:a,buttons:o})},openSettings:function(){var e;return e={pending:!0,searchAllPanes:!0},atom.workspace.open(`atom://config/packages/${o.name}`,e)},openURL:function(e){return n(9)(`https://idleberg.github.io/NSIS.docset/Contents/Resources/Documents/html/Reference/${e}.html?utm_source=atom&utm_content=reference`,{url:!0})},revealInstaller:function(e){var t,i,o,s;return({access:i,existsSync:o,F_OK:t}=n(5)),({shell:s}=n(10)),i(e,t,function(t){return t||""===e?console.log(t):s.showItemInFolder(e)})},runInstaller:function(e){var t,s,a,r;if(({exec:s,spawn:r}=n(1)),({platform:a}=n(3)),"win32"===a())try{return s(`cmd /c "${e}"`)}catch(e){return t=e,atom.notifications.addWarning(`**${o.name}**`,{detail:t,dismissable:!0})}else if(!0===i.getConfig("useWineToRun"))try{return r("wine",[e])}catch(e){return t=e,atom.notifications.addWarning(`**${o.name}**`,{detail:t,dismissable:!0})}},which:function(){var e;return({platform:e}=n(3)),"win32"===e()?"where":"which"}}},function(e,t){e.exports=require("child_process")},function(e,t){e.exports=require("atom-read-manifest")},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("makensis")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t,n){var i,o;({readManifestSync:o}=n(2)),i=o(),e.exports={compile:function(e,t){var o,s,a,r,c,l,u,d,m,f,p,h;return({spawn:h}=n(1)),({clearConsole:o,detectOutfile:s,getConfig:r,getMakensisPath:c,getPrefix:l,isWindowsCompatible:u,notifyOnCompletion:m}=n(0)),null==(a=atom.workspace.getActiveTextEditor())?atom.notifications.addWarning(`**${i.name}**: No active editor`,{dismissable:!1}):(p=a.getPath(),f=a.getGrammar().scopeName,!1===r("allowHeaderCompilation")&&p.endsWith("nsh")?(d=atom.notifications.addWarning("Compiling header files is blocked by default. You can allow it in the package settings.",{dismissable:!0,buttons:[{text:"Open Settings",className:"icon icon-gear",onDidClick:function(){return atom.workspace.open(`atom://config/packages/${i.name}`,{pending:!0,searchAllPanes:!0}),d.dismiss()}},{text:"Cancel",onDidClick:function(){return d.dismiss()}}]}),atom.beep()):null!=p&&f.startsWith("source.nsis")?a.save().then(function(){return c(function(n){var i,a,c,d,f;return f=l(),i=r("compilerArguments"),!0!==e||i.includes("-WX")||i.includes("/WX")||i.push(`${f}WX`),i.push(p),o(t),c=h(n,i),a=!1,d="",c.stdout.on("data",function(e){var n;if(n=e.toString(),!1===a&&-1!==e.indexOf("warning: ")){a=!0;try{r("alwaysShowOutput")&&t.warn(n)}catch(e){console.warn(n)}}else try{r("alwaysShowOutput")&&t.log(n)}catch(e){console.log(n)}if(""===d)return d=s(e)}),c.stderr.on("data",function(e){var n;n=e.toString();try{return t.error(n)}catch(e){return console.error(n)}}),c.on("close",function(e){var t;if(0===e){if(t=!0===u()?"Run":"",!0===a&&r("showBuildNotifications"))return m("warning",t,d);if(r("showBuildNotifications"))return m("success",t,d)}if(r("showBuildNotifications"))return atom.notifications.addError("Compile Error",{dismissable:!1})})})}):atom.beep())},showVersion:function(e){var t,o,s,a,r,c;return({spawn:r}=n(1)),({clearConsole:t,getConfig:o,getMakensisPath:s,getPrefix:a}=n(0)),({version:c}=n(4)),s(function(n){return t(e),c({pathToMakensis:n}).then(function(t){if("console"===o("compilerOutput").toLowerCase())try{e.log(`makensis ${t.stdout} (${n})`)}catch(e){console.info(`makensis ${t.stdout} (${n})`),atom.getCurrentWindow().openDevTools()}else atom.notifications.addInfo(`**${i.name}**`,{detail:`makensis ${t.stdout} (${n})`,dismissable:!0})}).catch(function(e){return console.error(e)})})},showCompilerFlags:function(e){var t,i,o,s,a,r,c,l;return({spawn:l}=n(1)),({clearConsole:t,getConfig:i,getMakensisPath:o,getPrefix:s,logCompilerFlags:r}=n(0)),({hdrInfo:a}=n(4)),(c=i("showFlagsAsObject"))&&" (JSON)",o(function(n){return t(e),a({pathToMakensis:n,json:c}).then(function(t){return r(t,c,e)}).catch(function(t){return r(t,c,e)})})},showHelp:function(e){var t,i,o,s,a,r,c;return({spawn:c}=n(1)),({clearConsole:t,getConfig:o,getMakensisPath:s,getPrefix:a,logCompilerFlags:r}=n(0)),({cmdHelp:i}=n(4)),s(function(t){return i("",{pathToMakensis:t,json:!0}).then(function(t){return e.update({items:Object.keys(t.stdout)})}).catch(function(t){return e.update({items:Object.keys(t.stdout)})})})}}},function(e,t,n){var i,o,s,a,r,c;({getConfig:i,getPrefix:o,openSettings:a}=n(0)),({readManifestSync:r}=n(2)),({satisfyDependencies:c}=n(11)),s=r(),e.exports={config:{pathToMakensis:{title:"Path To MakeNSIS",description:"Specify the full path to `makensis`",type:"string",default:"makensis",order:0},compilerArguments:{title:"Compiler Arguments",description:"Specify the default arguments for `makensis`, separated by commas ([see documentation](http://nsis.sourceforge.net/Docs/Chapter3.html#usage))",type:"array",default:[`${o()}V3`],items:{type:"string"},order:1},alwaysShowOutput:{title:"Always Show Output",description:"Displays compiler output in console panel. When deactivated, it will only show on errors",type:"boolean",default:!0,order:2},showBuildNotifications:{title:"Show Build Notifications",description:"Displays color-coded notifications that close automatically after 5 seconds",type:"boolean",default:!0,order:3},clearConsole:{title:"Clear Console",description:"When `console-panel` isn't available, build logs will be printed using `console.log()`. This setting clears the console prior to building.",type:"boolean",default:!0,order:4},allowHeaderCompilation:{title:"Allow Header Compilation",description:"By default, only `.nsi` files will be compiled. This setting enables it for `.nsh` files as well.",type:"boolean",default:!1,order:5},showFlagsAsObject:{title:"Show Flags as Object",description:"Displays compiler flags as JSON",type:"boolean",default:!0,order:6},buildFileSyntax:{title:"Build File Syntax",description:"Specify the default syntax for your build file (requires [build](https://atom.io/packages/build))",type:"string",default:"json",enum:[{value:"cson",description:"CSON"},{value:"json",description:"JSON"},{value:"yaml",description:"YAML"}],order:7},compilerOutput:{title:"Compiler Output",description:"Specify whether `makensis` outputs its version or compiler flags to notifications the console",type:"string",default:"notification",enum:[{value:"notification",description:"Notification"},{value:"console",description:"Console"}],order:8},useWineToRun:{title:"Use Wine to run",description:"When on a non-Windows platform, you can run compiled installers using [Wine](https://www.winehq.org/)",type:"boolean",default:!1,order:9},manageDependencies:{title:"Manage Dependencies",description:"When enabled, third-party dependencies will be installed automatically",type:"boolean",default:!0,order:10}},subscriptions:null,activate:function(e){var t,o,r,l,u,d;if(({CompositeDisposable:o}=n(12)),t=n(13),r=n(16),l=n(7),u=n(18),d=n(20),this.subscriptions=new o,this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:save-&-compile":()=>l.compile(!1,this.consolePanel)})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:save-&-compile-strict":()=>l.compile(!0,this.consolePanel)})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:show-version":()=>l.showVersion(this.consolePanel)})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:show-compiler-flags":()=>l.showCompilerFlags(this.consolePanel)})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:open-package-settings":function(){return a()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:satisfy-package-dependencies":function(){return c(s.name)}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:create-.atom–build-file":function(){return t.createFile(!1)}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:create-.atom–build-file-for-wine":function(){return t.createFile(!0)}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:set-default-runner":function(){return d.set()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:remove-default-runner":function(){return d.remove()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:command-reference":function(){return r.init(),r.toggle()}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:convert-language-file":function(){return u.convert()}})),!0===i("manageDependencies"))return c(s.name,{showPrompt:!0})},deactivate:function(){var e;return null!=(e=this.subscriptions)&&e.dispose(),this.subscriptions=null},consumeConsolePanel:function(e){this.consolePanel=e}}},function(e,t){e.exports=require("open")},function(e,t){e.exports=require("electron")},function(e,t){e.exports=require("atom-satisfy-dependencies")},function(e,t){e.exports=require("atom")},function(e,t,n){var i,o;({readManifestSync:o}=n(2)),i=o(),e.exports={createFile:function(e){var t,o,s,a,r,c,l,u,d,m,f;if(u=n(5),m=n(6),({getConfig:d}=n(0)),null!=(l=atom.workspace.getActiveTextEditor())){if("source.nsis"===l.getGrammar().scopeName)return a=!1,c=atom.workspace.getActivePaneItem().getPath(),r=m.basename(c),void 0===c?atom.confirm({message:"File not saved",detailedMessage:"You need to save this file before you can create a build-file",buttons:{OK:function(){}}}):(f=null,c=m.dirname(c),s=d("buildFileSyntax"),t="CSON"===s?".atom-build.cson":"YAML"===s?".atom-build.yml":".atom-build.json",o=m.join(c,t),u.access(`${o}`,u.constants.R_OK,function(i){var c,l,d,p,h,g;if(null===i?atom.confirm({message:"File exists",detailedMessage:"Do you really want to overwrite your existing build file?",buttons:{Overwrite:function(){return f="Overwriting existing file",a=!0},Abort:function(){}}}):(f="Saving file",a=!0),!0===a){switch(!0!==e?(l="makensis",h=!1):(p=atom.config.get("build-makensis-wine.pathToScript"),d=atom.packages.getPackageDirPaths().toString(),l=p?`"${p}"`:m.join(d,"build-makensis-wine","lib","makensis-wine.sh"),h=!0),c={name:`${r}`,cmd:l,args:["{FILE_ACTIVE}"],sh:h,cwd:"{FILE_ACTIVE_PATH}",errorMatch:'(\\r?\\n)(?<message>.+)(\\r?\\n)Error in script "(?<file>[^"]+)" on line (?<line>\\d+) -- aborting creation process',warningMatch:"[^!]warning: (?<message>.*) \\((?<file>(\\w{1}:)?[^:]+):(?<line>\\d+)\\)"},s){case"CSON":g=n(14).stringify(c,null,2);break;case"YAML":g=n(15).dump(c);break;default:g=JSON.stringify(c,null,2)}return u.writeFile(o,g,function(e){return e?atom.notifications.addError(t,{detail:e,dismissable:!1}):(atom.notifications.addInfo(t,{detail:f,dismissable:!1}),atom.workspace.open(o))})}}));atom.notifications.addWarning(`**${i.name}**: Unsupported document type`,{dismissable:!1})}else atom.notifications.addWarning(`**${i.name}**: No active editor`,{dismissable:!1})}}},function(e,t){e.exports=require("cson-parser")},function(e,t){e.exports=require("yaml-js")},function(e,t,n){var i;i=n(17),e.exports={init:function(){return this.selectListView=new i({emptyMessage:"No command matches your search.",items:[],filterKeyForItem:function(e){return e},elementForItem:function(e){var t,n;return n=e,(t=document.createElement("li")).innerHTML=n,t},didConfirmSelection:e=>{var t;return({openURL:t}=n(0)),this.cancel(),t(e)},didCancelSelection:()=>this.cancel()}),this.selectListView.element.classList.add("nsis-command-list")},dispose:function(){return this.cancel(),this.selectListView.destroy()},cancel:function(){if(null!=this.panel&&this.panel.destroy(),this.panel=null,this.previouslyFocusedElement)return this.previouslyFocusedElement.focus(),this.previouslyFocusedElement=null},attach:function(){return this.previouslyFocusedElement=document.activeElement,null==this.panel&&(this.panel=atom.workspace.addModalPanel({item:this.selectListView})),this.selectListView.focus(),this.selectListView.reset()},toggle:function(){var e;return null!=this.panel?this.cancel():(({showHelp:e}=n(7)),e(this.selectListView),this.attach())}}},function(e,t){e.exports=require("atom-select-list")},function(e,t,n){var i;i=n(19),e.exports={convert:function(){var e;return null==(e=atom.workspace.getActiveTextEditor())?atom.beep():"source.nlf"===e.getGrammar().scopeName?this.convertNLF(e):"source.json"===e.getGrammar().scopeName?this.convertJSON(e):atom.beep()},convertNLF:function(e){var t,n,o;try{n=e.getText(),o=i.parse(n,{stringify:!0})}catch(e){return t=e,console.error(t),atom.notifications.addError("Conversion Failed",{detail:t,dismissable:!0})}return this.openNewFile(e,o,"json")},convertJSON:function(e){var t,n,o;try{n=e.getText(),o=i.stringify(n)}catch(e){return t=e,console.error(t),atom.notifications.addError("Conversion Failed",{detail:t,dismissable:!0})}return this.openNewFile(e,o,"nlf")},openNewFile:function(e,t,i){var o,s,a,r;return({basename:o,extname:s}=n(6)),r=o(a=e.getFileName().toString(),s(a)),atom.workspace.open(`${r}.${i}`,{pending:!0}).then(function(e){return e.setText(t)}).catch(function(e){return atom.notifications.addError(e,{dismissable:!0})})}}},function(e,t){e.exports=require("@nsis/nlf")},function(e,t,n){var i,o;({readManifestSync:o}=n(2)),i=o(),e.exports={runner:null,set:function(){return this.check(),void 0!==this.runner.path&&!0===this.runner.active?atom.confirm({message:"Set default runner for NSIS",detailedMessage:"To compile NSIS scripts inside Atom, you need to define a runner. Do you want to use makensis as default runner?",buttons:{"Use makensis":function(){return atom.notifications.addSuccess(`**${i.name}**: Set \`runner.scopes.nsis\` to 'makensis -'`,{dismissable:!1}),atom.config.set("runner.scopes.nsis","makensis -")},Cancel:function(){atom.notifications.addWarning(`**${i.name}**: Cancelled setting default runner`,{dismissable:!1})}}}):this.notify()},remove:function(){return this.check(),void 0!==this.runner.path&&!0===this.runner.active?(atom.notifications.addSuccess(`**${i.name}**: Unset \`runner.scopes.nsis\``,{dismissable:!1}),atom.config.unset("runner.scopes.nsis")):this.notify()},notify:function(){return atom.notifications.addWarning(`**${i.name}**: [atom-runner](https://atom.io/packages/atom-runner) is not installed`,{dismissable:!1})},check:function(){return this.runner={path:atom.packages.resolvePackagePath("atom-runner"),active:atom.packages.isPackageLoaded("atom-runner")}}}}]);
//# sourceMappingURL=main.js.map