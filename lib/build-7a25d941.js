"use strict";var e,i=require("./main-80581fc7.js"),t=require("fs"),n=require("path");function s(s){return i.__awaiter(this,void 0,void 0,(function(){var r,a,o,c,l,u,d,f,m,g,h,p,b,v;return i.__generator(this,(function(w){switch(w.label){case 0:return[4,Promise.resolve().then((function(){return require("./util-0281ae28.js")}))];case 1:return r=w.sent(),a=r.findPackagePath,o=r.getMakensisPath,c=r.isLoadedAndActive,l=i.Config.get("useWineToRun"),u=c("build-makensis-wine"),[4,a("build-makensis-wine")];case 2:return d=w.sent()[0],f=[],(m=parseInt(String(i.Config.get("compilerOptions.verbosity"))))&&f.push("-V"+m),i.Config.get("compilerOptions.strictMode")&&f.push("-WX"),v={name:s.scriptFile},l&&u?(h=n.resolve(d,"lib","makensis-wine.sh"),[3,5]):[3,3];case 3:return[4,o()];case 4:h=w.sent(),w.label=5;case 5:return v.cmd=h,v.sh=l&&u,v.args=i.__spreadArray(i.__spreadArray([],f),["{FILE_ACTIVE}"]),v.cwd="{FILE_ACTIVE_PATH}",v.errorMatch='(\\r?\\n)(?<message>.+)(\\r?\\n)Error in script "(?<file>[^"]+)" on line (?<line>\\d+) -- aborting creation process',v.warningMatch="[^!]warning: (?<message>.*) \\((?<file>(\\w{1}:)?[^:]+):(?<line>\\d+)\\)",g=v,"yaml"!==s.syntax?[3,7]:[4,Promise.resolve().then((function(){return require("./index-a4ce64ef.js")})).then((function(e){return e.index}))];case 6:e=w.sent(),w.label=7;case 7:p="yaml"===s.syntax?e.stringify(g):JSON.stringify(g,null,2),w.label=8;case 8:return w.trys.push([8,10,,11]),[4,t.promises.writeFile(s.filePath,p,"utf-8")];case 9:return w.sent(),[3,11];case 10:return b=w.sent(),console.log(b),atom.notifications.addError("Failed to write "+s.fileName,{detail:b,dismissable:!1}),[2];case 11:return[4,atom.workspace.open(s.filePath)];case 12:return w.sent(),[2]}}))}))}require("os"),require("atom"),exports.createBuildFile=function(){var e,t;return i.__awaiter(this,void 0,void 0,(function(){var r,a,o,c,l,u,d,f,m,g,h,p;return i.__generator(this,(function(b){switch(b.label){case 0:return(r=atom.workspace.getActiveTextEditor())?"source.nsis"!==r.getGrammar().scopeName?(atom.notifications.addWarning("Unsupported document type",{dismissable:!1}),[2]):(a=r.getPath(),[4,Promise.resolve().then((function(){return require("./util-0281ae28.js")}))]):(atom.notifications.addWarning("No active editor",{dismissable:!1}),[2]);case 1:return o=b.sent().isHeaderFile,i.Config.get("processHeaders")&&o(a)?(c=atom.notifications.addWarning("Creating build-files for headers is blocked by default. You can allow this in the package settings.",{dismissable:!0,buttons:[{text:"Open Settings",className:"icon icon-gear",onDidClick:function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return c.dismiss(),[4,atom.workspace.open("atom://config/packages/language-nsis",{pending:!0,searchAllPanes:!0})];case 1:return e.sent(),[2]}}))}))}},{text:"Cancel",onDidClick:function(){c.dismiss()}}]}),atom.beep(),[2]):(l=(null===(t=null===(e=atom.workspace)||void 0===e?void 0:e.getActiveTextEditor())||void 0===t?void 0:t.getPath())||null)?(d=n.basename(l),f=n.dirname(l),m=String(i.Config.get("buildFileSyntax")),g=".atom-build."+m.toLowerCase(),h=n.join(f,g),[4,Promise.resolve().then((function(){return require("./util-0281ae28.js")}))]):(u=atom.notifications.addWarning("File not saved",{dismissable:!0,detail:"You need to save this file manually before you can create a build-file",buttons:[{text:"OK",onDidClick:function(){u.dismiss()}}]}),[2]);case 2:return[4,(0,b.sent().fileExists)(h)];case 3:return b.sent()?p=atom.notifications.addWarning("File exists",{dismissable:!0,detail:"Do you really want to overwrite your existing build file?",buttons:[{text:"Overwrite",onDidClick:function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return p.dismiss(),s({script:d,syntax:m,fileName:g,filePath:h}),[2]}))}))}},{text:"Abort",onDidClick:function(){p.dismiss()}}]}):s({script:d,syntax:m,fileName:g,filePath:h}),[2]}}))}))};
//# sourceMappingURL=build-7a25d941.js.map
