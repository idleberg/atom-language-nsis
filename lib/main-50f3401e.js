"use strict";var e=require("path"),t=require("dotenv"),n=require("fs"),s=require("child_process"),i=require("os"),r=require("atom-satisfy-dependencies"),o=require("atom"),a=require("execa"),c=require("util"),u=require("which"),l=require("makensis"),d=require("@nsis/nlf"),f=require("atom-select-list");function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function h(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var m=p(e),v=p(n),g=p(s),b=p(i),w=p(a),y=p(c),S=p(u),k=h(l),N=p(d),x=p(f);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function C(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))}function P(e,t){var n,s,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(i=2&r[0]?s.return:r[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,s=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],s=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function E(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var s=Array(e),i=0;for(t=0;t<n;t++)for(var r=arguments[t],o=0,a=r.length;o<a;o++,i++)s[i]=r[o];return s}var O={browse:null,consumer:function(e){var t=this;return this.browse=e,new o.Disposable((function(){t.browse=null}))},reveal:function(e){return C(this,void 0,void 0,(function(){return P(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.browse({action:"reveal",target:e})];case 1:return t.sent(),[3,3];case 2:return t.sent(),Q("browse"),[3,3];case 3:return[2]}}))}))}},D={consolePanel:null,consumer:function(e){var t=this;return this.consolePanel=e,new o.Disposable((function(){t.consolePanel=null}))},toggle:function(){this.consolePanel.toggle()},clear:function(){this.consolePanel.clear()},log:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.consolePanel).log.apply(e,t)},error:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.consolePanel).error.apply(e,t)},warn:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.consolePanel).warn.apply(e,t)}};function F(e){for(var t,n=[],s=1;s<arguments.length;s++)n[s-1]=arguments[s];(null===atom||void 0===atom?void 0:atom.inDevMode())&&(n.unshift("[language-nsis]"),(t=global.console)[e].apply(t,n))}var I=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];F.apply(void 0,E(["log"],e))},j=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];F.apply(void 0,E(["warn"],e))};let _;var T,W=()=>(void 0===_&&(_=function(){try{return v.default.statSync("/.dockerenv"),!0}catch(e){return!1}}()||function(){try{return v.default.readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch(e){return!1}}()),_),A=(function(e){const t=()=>{if("linux"!==process.platform)return!1;if(b.default.release().toLowerCase().includes("microsoft"))return!W();try{return!!v.default.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")&&!W()}catch(e){return!1}};process.env.__IS_WSL_TEST__?e.exports=t:e.exports=t()}(T={exports:{}},T.exports),T.exports);const{promisify:q}=y.default,L=q(v.default.access),M=q(g.default.execFile),R=m.default.join(__dirname,"xdg-open");var V=async(e,t)=>{if("string"!=typeof e)throw new TypeError("Expected a `target`");let n;t={wait:!1,background:!1,allowNonzeroExitCode:!1,...t};let{app:s}=t,i=[];const r=[],o={};if(Array.isArray(s)&&(i=s.slice(1),s=s[0]),"darwin"===process.platform)n="open",t.wait&&r.push("--wait-apps"),t.background&&r.push("--background"),s&&r.push("-a",s);else if("win32"===process.platform||A&&!W()){const a=A?await(async e=>{const{stdout:t}=await M("wslvar",[e]);return t.trim()})("systemroot"):process.env.SYSTEMROOT;n=String.raw`${a}\System32\WindowsPowerShell\v1.0\powershell${A?".exe":""}`,r.push("-NoProfile","-NonInteractive","â€“ExecutionPolicy","Bypass","-EncodedCommand"),A?n=await(async e=>{const{stdout:t}=await M("wslpath",[e]);return t.trim()})(n):o.windowsVerbatimArguments=!0;const c=["Start"];if(t.wait&&c.push("-Wait"),s){if(A&&s.startsWith("/mnt/")){s=await(async e=>{const{stdout:t}=await M("wslpath",["-w",e]);return t.trim()})(s)}c.push(`"\`"${s}\`""`,"-ArgumentList"),i.unshift(e)}else c.push(`"\`"${e}\`""`);i.length>0&&(i=i.map((e=>`"\`"${e}\`""`)),c.push(i.join(","))),e=Buffer.from(c.join(" "),"utf16le").toString("base64")}else{if(s)n=s;else{const e=!__dirname||"/"===__dirname;let t=!1;try{await L(R,v.default.constants.X_OK),t=!0}catch(e){}n=process.versions.electron||"android"===process.platform||e||!t?"xdg-open":R}i.length>0&&r.push(...i),t.wait||(o.stdio="ignore",o.detached=!0)}r.push(e),"darwin"===process.platform&&i.length>0&&r.push("--args",...i);const a=g.default.spawn(n,r,o);return t.wait?new Promise(((e,n)=>{a.once("error",n),a.once("close",(s=>{t.allowNonzeroExitCode&&s>0?n(new Error(`Exited with code ${s}`)):e(a)}))})):(a.unref(),a)};function B(){try{D.clear()}catch(e){z("clearConsole")&&console.clear()}}function H(e){return C(this,void 0,void 0,(function(){return P(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,n.promises.access(e,n.constants.F_OK)];case 1:return t.sent(),[3,3];case 2:return t.sent(),[2,!1];case 3:return[2,!0]}}))}))}function $(){return C(this,void 0,void 0,(function(){var t,n,s,i;return P(this,(function(r){switch(r.label){case 0:return t=void 0,(n=atom.project.getPaths()[0])?(s=!0,[4,H(e.resolve(n,".env.local"))]):[3,10];case 1:switch(s){case r.sent():return[3,5]}return(i=process.env.NODE_ENV)?[4,H(e.resolve(n,".env.["+process.env.NODE_ENV+"]"))]:[3,3];case 2:i=r.sent(),r.label=3;case 3:switch(s){case i:return[3,6]}return[4,H(e.resolve(n,".env"))];case 4:switch(s){case r.sent():return[3,7]}return[3,8];case 5:return t=e.resolve(n,".env.local"),[3,9];case 6:return t=e.resolve(n,".env.["+process.env.NODE_ENV+"]"),[3,9];case 7:return t=e.resolve(n,".env"),[3,9];case 8:return[3,9];case 9:t&&I("Found DotEnv file "+t),r.label=10;case 10:return[2,t]}}))}))}function z(e){return e?atom.config.get("language-nsis."+e):atom.config.get("language-nsis")}function J(){return C(this,void 0,void 0,(function(){var e,t;return P(this,(function(n){switch(n.label){case 0:return(null==(e=String(z("pathToMakensis")))?void 0:e.length)&&"makensis"!==e?[2,e]:(t=String,[4,S.default("makensis")]);case 1:return[2,t.apply(void 0,[n.sent()])||"makensis"]}}))}))}function G(){return C(this,void 0,void 0,(function(){return P(this,(function(e){return[2,{env:{NSISDIR:process.env.NSISDIR||void 0,NSISCONFDIR:process.env.NSISCONFDIR||void 0}}]}))}))}function K(){return C(this,void 0,void 0,(function(){var e,n;return P(this,(function(s){switch(s.label){case 0:return e=t.config,n={},[4,$()];case 1:return e.apply(void 0,[(n.path=s.sent(),n)]),[2]}}))}))}function Y(e){return Boolean([".bnsh",".nsh"].filter((function(t){return null==e?void 0:e.endsWith(t)})).length)}function U(e){return atom.packages.isPackageLoaded(e)&&atom.packages.isPackageActive(e)}function X(){return C(this,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return[4,r.satisfyDependencies("language-nsis")];case 1:return e.sent(),[2]}}))}))}function Q(e){var t=atom.notifications.addWarning("This command requires the `"+e+"` package to be installed and enabled",{dismissable:!0,buttons:[{text:"Show Package",onDidClick:function(){return C(this,void 0,void 0,(function(){return P(this,(function(n){switch(n.label){case 0:return t.dismiss(),[4,atom.workspace.open("atom://config/packages/"+e,{pending:!0,searchAllPanes:!0})];case 1:return n.sent(),[2]}}))}))}},{text:"Cancel",onDidClick:function(){t.dismiss()}}]})}function Z(e,t,n){var s=atom.notifications[e](t,{dismissable:!0,buttons:n?["win32"===i.platform()||z("useWineToRun")?{text:"Run",className:"icon icon-playback-play",onDidClick:function(){return C(this,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return s.dismiss(),[4,ee(n)];case 1:return e.sent(),[2]}}))}))}}:void 0,U("browse")?{text:"Reveal",className:"icon icon-location",onDidClick:function(){s.dismiss(),O.reveal(n)}}:void 0,{text:"Cancel",onDidClick:function(){s.dismiss()}}].filter((function(e){return e})):[]})}function ee(e){return C(this,void 0,void 0,(function(){var t;return P(this,(function(n){switch(n.label){case 0:if("win32"!==i.platform())return[3,1];try{s.exec('cmd /c "'+e+'"')}catch(e){console.error(e),atom.notifications.addWarning("Failed to run installer, see console for details",{dismissable:!0})}return[2];case 1:if(!0!==z("useWineToRun"))return[3,5];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,w.default("wine",[e])];case 3:return n.sent(),[3,5];case 4:return t=n.sent(),atom.notifications.addWarning("Failed to run installer, see console for details",{dismissable:!0}),console.error(t),[3,5];case 5:return[2]}}))}))}function te(e){var t=e.hasWarning?"warn":"log";try{z("alwaysShowOutput")&&(D.toggle(),D[t](e.line))}catch(n){console[t](e.line)}}function ne(e){try{D.error(e.line)}catch(t){console.error(e.line)}}function se(e){0===e.status?e.warnings&&z("showBuildNotifications")?Z("addWarning","Compiled with warnings",e.outFile):z("showBuildNotifications")&&Z("addSuccess","Compiled successfully",e.outFile):z("showBuildNotifications")&&atom.notifications.addError("Compile Error",{dismissable:!1})}function ie(e){var t=e.stdout||e.stderr;if("console"===String(z("compilerOutput")).toLowerCase())try{D.toggle(),D.log(JSON.stringify(t,null,2))}catch(e){console.info(t),atom.openDevTools()}else atom.notifications.addInfo("Compiler Flags",{detail:JSON.stringify(t,null,2),dismissable:!0})}var re={busySignal:null,serviceName:"busy-signal",consumer:function(e){var t=this;return this.busySignal=e.create(),new o.Disposable((function(){t.busySignal=null}))},add:function(e){try{this.busySignal.add(e)}catch(e){Q(this.serviceName)}},remove:function(){try{this.busySignal.remove()}catch(e){Q(this.serviceName)}},clear:function(){try{this.busySignal.clear()}catch(e){Q(this.serviceName)}},dispose:function(){try{this.busySignal.dispose()}catch(e){Q(this.serviceName)}}};function oe(t){return C(this,void 0,void 0,(function(){var n,s,i,r,o,a,c,u,d;return P(this,(function(f){switch(f.label){case 0:if(!(n=atom.workspace.getActiveTextEditor()))return atom.notifications.addWarning("No active editor",{dismissable:!1}),[2];if(s=n.getPath(),i=n.getGrammar().scopeName,!1===z("processHeaders")&&Y(s))return r=atom.notifications.addWarning("Compiling header files is blocked by default. You can allow this in the package settings.",{dismissable:!0,buttons:[{text:"Open Settings",className:"icon icon-gear",onDidClick:function(){return C(this,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return[4,atom.workspace.open("atom://config/packages/language-nsis",{pending:!0,searchAllPanes:!0})];case 1:return e.sent(),r.dismiss(),[2]}}))}))}},{text:"Cancel",onDidClick:function(){r.dismiss()}}]}),atom.beep(),[2];if(!s||!i.startsWith("source.nsis"))return[3,8];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,n.save()];case 2:return f.sent(),[3,4];case 3:return o=f.sent(),console.log(o),atom.beep(),[2];case 4:return B(),U("busy-signal")&&re.add("Compiling "+e.basename(s)),l.events.on("stdout",te),l.events.on("stderr",ne),l.events.once("exit",se),c=(a=k).compile,u=[s],d={define:(p={},Object.keys(process.env).map((function(e){e.length&&new RegExp("NSIS_APP_[a-z0-9]+","gi").test(e)&&(p[e]=process.env[e])})),Object.keys(p).length?p:void 0),json:z("showFlagsAsObject")},[4,J()];case 5:return u=u.concat([(d.pathToMakensis=f.sent(),d.strict=t,d.verbose=z("compilerVerbosity"),d)]),[4,G()];case 6:return[4,c.apply(a,u.concat([f.sent()]))];case 7:f.sent(),l.events.removeAllListeners(),U("busy-signal")&&re.clear(),f.label=8;case 8:return[2]}var p}))}))}function ae(){return C(this,void 0,void 0,(function(){var e,t,n,s;return P(this,(function(i){switch(i.label){case 0:return U("busy-signal")&&re.add("Showing version"),B(),[4,J()];case 1:return e=i.sent(),l.events.once("stdout",(function(t){return function(e,t){if("console"===String(z("compilerOutput")).toLowerCase())try{D.toggle(),D.log("makensis "+e.line+" ("+t+")")}catch(n){console.info("makensis "+e.line+" ("+t+")"),atom.openDevTools()}else atom.notifications.addInfo("NSIS Version",{detail:"makensis "+e.line+" ("+t+")",dismissable:!0})}(t,e)})),n=(t=k).version,s=[{pathToMakensis:e}],[4,G()];case 2:return[4,n.apply(t,s.concat([i.sent()]))];case 3:return i.sent(),U("busy-signal")&&re.clear(),[2]}}))}))}function ce(){return C(this,void 0,void 0,(function(){var e,t,n,s;return P(this,(function(i){switch(i.label){case 0:return U("busy-signal")&&re.add("Showing compiler flags"),B(),l.events.once("exit",ie),t=(e=k).headerInfo,s={json:z("showFlagsAsObject")},[4,J()];case 1:return n=[(s.pathToMakensis=i.sent(),s)],[4,G()];case 2:return[4,t.apply(e,n.concat([i.sent()]))];case 3:return i.sent(),U("busy-signal")&&re.clear(),[2]}}))}))}function ue(e){return C(this,void 0,void 0,(function(){var t,n,s,i,r;return P(this,(function(o){switch(o.label){case 0:return s=(n=k).cmdHelp,i=[""],r={json:!0},[4,J()];case 1:return i=i.concat([(r.pathToMakensis=o.sent(),r)]),[4,G()];case 2:return[4,s.apply(n,i.concat([o.sent()]))];case 3:return t=o.sent(),e.update({items:Object.keys(t.stdout)}),[2]}}))}))}function le(){return C(this,void 0,void 0,(function(){var e;return P(this,(function(t){switch(t.label){case 0:if(!(e=atom.workspace.getActiveTextEditor()))return atom.beep(),[2];switch(e.getGrammar().scopeName){case"source.nlf":return[3,1];case"source.json":case"source.json5":return[3,3]}return[3,5];case 1:return[4,de(e)];case 2:return t.sent(),[3,6];case 3:return[4,fe(e)];case 4:return t.sent(),[3,6];case 5:return atom.beep(),[3,6];case 6:return[2]}}))}))}function de(e){return C(this,void 0,void 0,(function(){var t,n;return P(this,(function(s){switch(s.label){case 0:try{n=e.getText(),t=N.default.parse(n,{stringify:!0})}catch(e){return console.error(e),atom.notifications.addError("Conversion Failed",{detail:e,dismissable:!0}),[2]}return[4,pe(e,t,"json")];case 1:return s.sent(),[2]}}))}))}function fe(e){return C(this,void 0,void 0,(function(){var t,n;return P(this,(function(s){switch(s.label){case 0:try{n=e.getText(),t=N.default.stringify(n)}catch(e){return console.error(e),atom.notifications.addError("Conversion Failed",{detail:e,dismissable:!0}),[2]}return[4,pe(e,t,"nlf")];case 1:return s.sent(),[2]}}))}))}function pe(t,n,s){return C(this,void 0,void 0,(function(){var i,r,o,a;return P(this,(function(c){switch(c.label){case 0:r=t.getFileName().toString(),o=e.basename(r,e.extname(r)),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,atom.workspace.open(o+"."+s,{pending:!0})];case 2:return i=c.sent(),[3,4];case 3:return a=c.sent(),console.error(a),atom.notifications.addError(a,{dismissable:!0}),[2];case 4:return i.setText(n),[2]}}))}))}var he={init:function(){var e=this;this.selectListView=new x.default({emptyMessage:"No command matches your search.",items:[],filterKeyForItem:function(e){return e},elementForItem:function(e){var t=document.createElement("li"),n=e;return t.innerHTML=n,t},didConfirmSelection:function(t){e.cancel(),V("https://idleberg.github.io/NSIS.docset/Contents/Resources/Documents/html/Reference/"+t+".html?utm_source=atom&utm_content=reference",{url:!0})},didCancelSelection:function(){e.cancel()}}),this.selectListView.element.classList.add("nsis-command-list")},dispose:function(){this.cancel(),this.selectListView.destroy()},cancel:function(){null!=this.panel&&this.panel.destroy(),this.panel=null,this.previouslyFocusedElement&&(this.previouslyFocusedElement.focus(),this.previouslyFocusedElement=null)},attach:function(){this.previouslyFocusedElement=document.activeElement,null==this.panel&&(this.panel=atom.workspace.addModalPanel({item:this.selectListView})),this.selectListView.focus(),this.selectListView.reset()},toggle:function(){return C(this,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return null==this.panel?[3,1]:(this.cancel(),[3,3]);case 1:return[4,ue(this.selectListView)];case 2:e.sent(),this.attach(),e.label=3;case 3:return[2]}}))}))}},me={config:{pathToMakensis:{title:"Path To MakeNSIS",description:"Specify the full path to `makensis`",type:"string",default:"makensis",order:0},compilerVerbosity:{title:"Compiler Verbosity",description:"Specify the default verbosity for `makensis`",type:"string",default:"3",enum:[{value:"0",description:"0 - none"},{value:"1",description:"1 - no warnings"},{value:"2",description:"2 - no info"},{value:"3",description:"3 - no script"},{value:"4",description:"4 - all"}],order:1},alwaysShowOutput:{title:"Always Show Output",description:"Displays compiler output in console panel. When deactivated, it will only show on errors",type:"boolean",default:!0,order:2},showBuildNotifications:{title:"Show Build Notifications",description:"Displays color-coded notifications that close automatically after 5 seconds",type:"boolean",default:!0,order:3},clearConsole:{title:"Clear Console",description:"When `console-panel` isn't available, build logs will be printed using `console.log()`. This setting clears the console prior to building.",type:"boolean",default:!0,order:4},processHeaders:{title:"Process Headers",description:"By default, you can only compile (and create build-files) for `.nsi` files. This setting enables support for `.nsh` files.",type:"boolean",default:!1,order:5},showFlagsAsObject:{title:"Show Flags as Object",description:"Displays compiler flags as JSON",type:"boolean",default:!0,order:6},buildFileSyntax:{title:"Build File Syntax",description:"Specify the default syntax for your build file (requires [build](https://atom.io/packages/build))",type:"string",default:"json",enum:[{value:"json",description:"JSON"},{value:"yaml",description:"YAML"}],order:7},compilerOutput:{title:"Compiler Output",description:"Specify whether `makensis` outputs its version or compiler flags to notifications the console",type:"string",default:"console",enum:[{value:"notification",description:"Notification"},{value:"console",description:"Console"}],order:8},useWineToRun:"win32"!==i.platform()?{title:"Use Wine to run",description:"When on a non-Windows platform, you can run compiled installers using [Wine](https://www.winehq.org/)",type:"boolean",default:!1,order:9}:{},manageDependencies:{title:"Manage Dependencies",description:"When enabled, third-party dependencies will be installed automatically",type:"boolean",default:!0,order:10}},subscriptions:null,activate:function(){return C(this,void 0,void 0,(function(){var e=this;return P(this,(function(t){switch(t.label){case 0:return I("Activating package"),[4,K()];case 1:return t.sent(),this.subscriptions=new o.CompositeDisposable,this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:command-reference":function(){return C(e,void 0,void 0,(function(){return P(this,(function(e){return he.init(),he.toggle(),[2]}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:compile":function(){return C(e,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return[4,oe(!1)];case 1:return[2,e.sent()]}}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:compile-strict":function(){return C(e,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return[4,oe(!0)];case 1:return[2,e.sent()]}}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:create-.atomâ€“build-file":function(){return C(e,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return U("build")?[4,Promise.resolve().then((function(){return require("./build-1b2e253b.js")}))]:[3,3];case 1:return[4,(0,e.sent().createBuildFile)()];case 2:return e.sent(),[3,4];case 3:Q("build"),e.label=4;case 4:return[2]}}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:convert-language-file":function(){return C(e,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return[4,le()];case 1:return[2,e.sent()]}}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:show-compiler-flags":function(){return C(e,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return[4,ce()];case 1:return[2,e.sent()]}}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:show-version":function(){return C(e,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return[4,ae()];case 1:return[2,e.sent()]}}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:open-package-settings":function(){return C(e,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return[4,atom.workspace.open("atom://config/packages/language-nsis",{pending:!0,searchAllPanes:!0})];case 1:return e.sent(),[2]}}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:satisfy-dependencies":function(){return C(e,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return[4,X()];case 1:return[2,e.sent()]}}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:set-default-runner":function(){return C(e,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return U("atom-runner")?[4,Promise.resolve().then((function(){return require("./runner-480073f5.js")}))]:[3,3];case 1:return[4,(0,e.sent().setRunner)()];case 2:return e.sent(),[3,4];case 3:Q("runner"),e.label=4;case 4:return[2]}}))}))}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"NSIS:unset-default-runner":function(){return C(e,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return U("atom-runner")?[4,Promise.resolve().then((function(){return require("./runner-480073f5.js")}))]:[3,3];case 1:return[4,(0,e.sent().unsetRunner)()];case 2:return e.sent(),[3,4];case 3:Q("runner"),e.label=4;case 4:return[2]}}))}))}})),z("manageDependencies")?[4,X()]:[3,3];case 2:t.sent(),t.label=3;case 3:return function(e,t){if(atom.config.get("language-nsis."+t))j("Setting '"+t+"' already exists, skipping migration");else{try{atom.config.set("language-nsis."+t,atom.config.get("language-nsis."+e))}catch(e){return console.log(e),void atom.notifications.addWarning("Failed to migrate configuration, see console for details")}j("Setting '"+e+"' migrated successfully to '"+t+"'"),atom.config.unset("language-nsis."+e)}}("allowHeaderCompilation","processHeaders"),atom.config.unset("language-nsis.compilerArguments"),[2]}}))}))},deactivate:function(){var e;I("Deactivating package"),null===(e=this.subscriptions)||void 0===e||e.dispose()},consumeConsolePanel:function(e){I("Consuming Console Panel service"),D.consumer(e)},consumeBrowse:function(e){I("Consuming Browse service"),O.consumer(e)},consumeSignal:function(e){I("Consuming Busy Signal service"),re.consumer(e)}};exports.__awaiter=C,exports.__generator=P,exports.fileExists=H,exports.findPackagePath=function(t){return C(this,void 0,void 0,(function(){var n,s=this;return P(this,(function(i){switch(i.label){case 0:return n=atom.packages.getPackageDirPaths(),[4,Promise.all(n.map((function(n){return C(s,void 0,void 0,(function(){var s;return P(this,(function(i){switch(i.label){case 0:return s=e.resolve(n,t),[4,H(e.resolve(s,"package.json"))];case 1:return i.sent()?[2,s]:[2,void 0]}}))}))})))];case 1:return[2,i.sent().filter((function(e){return e}))]}}))}))},exports.getConfig=z,exports.getMakensisPath=J,exports.isHeaderFile=Y,exports.isLoadedAndActive=U,exports.main=me;
//# sourceMappingURL=main-50f3401e.js.map
